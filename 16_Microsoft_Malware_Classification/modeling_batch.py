from xgboost import XGBClassifier
from sklearn.calibration import CalibratedClassifierCV
from sklearn.metrics import log_loss
from sklearn.model_selection import train_test_split
from sklearn.model_selection import RandomizedSearchCV
import pickle as pkl
import os
import pandas as pd
import numpy as np
from scipy.sparse import hstack
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix

def getPickel(path):
    file = open(path,'rb')
    obj =  pkl.load(file)
    return obj

def putPickel(var,path):
    file = open(path,'wb')
    pkl.dump(var,file)
    file.close()

data_y = getPickel("/scratch/sisodiya.bhoomendra/labels.pkl")
X = getPickel("/scratch/sisodiya.bhoomendra/X_size_asm_1_Class_1_asm_51_byte_2000_size_1.pkl")

X_train, X_test, y_train, y_test = train_test_split(X, data_y,stratify=data_y,test_size=0.20)
x_cfl=XGBClassifier(tree_method='gpu_hist')
prams={
    'learning_rate':[0.01,0.05,0.1,0.2],
     'n_estimators':[500,700,1000],
     'max_depth':[3,5],
    'colsample_bytree':[0.5,1],
    'subsample':[0.5,1]
}

random_cfl1=RandomizedSearchCV(x_cfl,param_distributions=prams,verbose=100,n_jobs=20,)
random_cfl1.fit(X_train,y_train)

putPickel(random_cfl1,"/scratch/sisodiya.bhoomendra/")